{% extends '_base.html' %}{% load humanize staticfiles %}

{% block head_title %}{{ block.super }}{% endblock %}
{% block body_id %}homepage{% endblock %}

{% block head_css_extra %}
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
<!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
<![endif]-->
<link href='/static/css/vendor/leaflet.label.css' rel='stylesheet' />
{% endblock %}

{% block content_container %}
<div class="content-container clearfix tan-stripe">
    <article id="profile" class="clearfix wrapper">
        <section class="column-full clearfix">
            <h1 class="article-header">Profile a place</h1>
            <div id="geography-select-wrapper">
                <input name="geography_select" id="geography-select-home" type="text" placeholder="Start typing a place name or address..." autocomplete="off">
                {% comment %}
                <div class="geolocate-only">
                    <span class="or">or</span>
                    <a href="{% url 'locate' %}" class="action-button"><i class="fa fa-location-arrow"></i> <span class="wide-only">Find places based on</span><span class="narrow-only">Use</span> your current location</a>
                </div>
                {% endcomment %}
            </div>
        </section>
        <section>
            <div id="landing-slippy-map"></div>
        </section>
        <section>
            <div class="column-third callout with-icon">
                <h3>
                    <i class="fa fa-book"></i>
                    Find facts
                </h3>
                <p>Populations and dollar figures that help you understand a place, broken down by category: Demographics, Economics, Families, Housing and Social.</p>
            </div>
            <div class="column-third callout with-icon">
                <h3>
                    <i class="fa fa-bar-chart-o"></i>
                    Visualize
                </h3>
                <p>We&rsquo;re continuing to build a library of charts to give you insight into data from the places you research. Look for them on profile pages.</p>
            </div>
            <div class="column-third callout with-icon">
                <h3>
                    <i class="fa fa-refresh"></i>
                    Get context
                </h3>
                <p>We&rsquo;re working on pre-computed statistics to add context to each data point, so you can see how each place fits into its province and country.</p>
            </div>
        </section>
        <section class="column-full">
            <p class="explainer">TODO is a joint project by <a href="http://www.code4sa.org/">Code4SA</a> and <a href="http://www.mediamonitoringafrica.org/">Media Monitoring Africa</a> that provides easy access to South African census and elections data. Place profiles visualize and compare statistics for the following: <span>demographics</span>, <span>elections</span>, <span>education</span>, <span>economics</span> and <span>service delivery</span>.
            <p>TODO started out as a fork of <a href="http://censusreporter.org/">Census Reporter</a>, a tool for investigating US census data. Census Reporter and TODO are both open source. You can find them on Github <a href="https://github.com/censusreporter/censusreporter/">here</a> and <a href="https://github.com/Code4SA/censusreporter/">here</a>.</p>
        </section>
    </article>
</div>

<div class="content-container clearfix tan-stripe">
    <article id="examples" class="clearfix wrapper">
        <header class="column-full">
            <h1 class="article-header">How to use this site</h1>
            <p class="explainer"></p>
        </header>
        <section class="card-container clearfix">
            <h2 class="column-full subhead">Finding places</h2>
            <h2 class="column-full subhead">Exploring data</h2>
            {% comment %}
            <a class="column-third card" href="/compare/01000US/040/map/?release=acs2012_1yr&table=B06011">
                <img src="{% static 'img/examples/us_median_income_map.png' %}">
                <span class="caption">How does median income compare from state to state? <span class="more">More &rarr;</span></span>
            </a>
            <a class="column-third card" href="/profiles/16000US0644000/">
                <img src="{% static 'img/examples/language_los_angeles.png' %}">
                <span class="caption">What languages do people speak at home in Los Angeles? <span class="more">More &rarr;</span></span>
            </a>
            <a class="column-third card" href="/compare/01000US/040/distribution/?release=acs2012_1yr&table=B07009">
                <img src="{% static 'img/examples/us_geographic_mobility_distribution.png' %}">
                <span class="caption">Where are people most mobile, and what skills do they have? <span class="more">More &rarr;</span></span>
            </a>
            <a class="column-third card" href="/profiles/16000US5367000/">
                <img src="{% static 'img/examples/poverty_spokane.png' %}">
                <span class="caption">How many children live in poverty in Spokane, Wash.? <span class="more">More &rarr;</span></span>
            </a>
            <a class="column-third card" href="/compare/01000US/040/table/?release=acs2012_1yr&table=B02001">
                <img src="{% static 'img/examples/us_race_table.png' %}">
                <span class="caption">What is the racial makeup of the U.S., and how do states compare? <span class="more">More &rarr;</span></span>
            </a>
            <a class="column-third card" href="/profiles/16000US3916000/">
                <img src="{% static 'img/examples/education_cleveland.png' %}">
                <span class="caption">How many people have college degrees in Cleveland? <span class="more">More &rarr;</span></span>
            </a>
            {% endcomment %}
        </section>
    </article>
</div>
{% endblock %}

{% block body_javascript_extra %}{{ block.super }}
<script src="{% static 'js/vendor/d3.v3.min.js' %}"></script>
<script src="{% static 'js/vendor/topojson.v1.min.js' %}"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
<script src="/static/js/vendor/leaflet.label.js"></script>
<script src="{% static 'js/charts.js' %}"></script>
<script>
// show 'use my current location' button
if (Modernizr.geolocation) {
    $('.geolocate-only').show();
}
// geoSelect already defined by widget.geo.select.js
geoSelect.focus()

// draw a map
var allowMapDrag = (browserWidth > 480) ? true : false;
var map = L.map('landing-slippy-map', {
    scrollWheelZoom: false,
    zoomControl: false,
    doubleClickZoom: false,
    boxZoom: false,
    keyboard: false,
    dragging: allowMapDrag,
    touchZoom: allowMapDrag
});

map.setView({lat: -28.4796, lng: 24.698445}, 5);

if (allowMapDrag) {
    map.addControl(new L.Control.Zoom({
        position: 'topright'
    }));
}

// add imagery
L.tileLayer('http://{s}.tile.stamen.com/toner-lite/{z}/{x}/{y}.png', {
	attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
	subdomains: 'abcd',
	maxZoom: 13
}).addTo(map);

// add province boundaries
d3.json("http://maps.code4sa.org/political/2011/province?quantization=1000", function(error, topo) {
    if (!topo)
        return;

    var featureLayer = L.geoJson(topojson.feature(topo, topo.objects.demarcation), {
        style: {
            "clickable": true,
            "color": "#00d",
            "fillColor": "#ccc",
            "weight": 1.0,
            "opacity": 0.3,
            "fillOpacity": 0.3,
        },
        onEachFeature: function(feature, layer) {
            var name = feature.properties['province_name'];
            var code = feature.properties['province'];

            layer.bindLabel(name, {direction: 'auto'});
            layer.on('mouseover', function() {
                layer.setStyle({
                    "fillOpacity": 0.5,
                });
            });
            layer.on('mouseout', function() {
                layer.setStyle({
                    "fillOpacity": 0.3,
                });
            });
            layer.on('click', function() {
                window.location = '/profiles/province-' + code;
            });
        },
    });
    map.addLayer(featureLayer);
});
</script>
<script src="{% static 'js/vendor/spin.min.js' %}"></script>
<script src="{% static 'js/comparison.builder.js' %}"></script>
{% endblock %}
